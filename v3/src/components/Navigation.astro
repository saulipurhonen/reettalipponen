---
import { UI_STRINGS, DEFAULT_LOCALE } from "../lib/i18n"

const navItems = UI_STRINGS[DEFAULT_LOCALE].navigation
const pathname = Astro.url.pathname

function isActive(href: string): boolean {
  if (href === "/") {
    return pathname === "/"
  }
  return pathname.startsWith(href)
}
---

<header class="relative z-50">
  <nav class="mx-auto flex max-w-6xl items-center justify-between px-4 py-4">
    <!-- Desktop nav -->
    <ul class="hidden md:flex md:items-center md:gap-6">
      {
        navItems.map((item) => (
          <li>
            <a
              href={item.href}
              class:list={[
                "text-sm transition-colors hover:text-gray-900",
                isActive(item.href)
                  ? "font-bold text-gray-900"
                  : "text-gray-600",
              ]}
              {...(isActive(item.href) ? { "aria-current": "page" } : {})}
            >
              {item.label}
            </a>
          </li>
        ))
      }
    </ul>

    <!-- Mobile hamburger button -->
    <button
      id="menu-toggle"
      class="relative z-50 md:hidden p-2 group"
      type="button"
      aria-label="Avaa valikko"
      aria-expanded="false"
      aria-controls="mobile-menu"
    >
      <div class="relative h-3.5 w-5">
        <span
          id="bar-1"
          class="absolute left-0 top-0 block h-0.5 w-5 bg-current transition-all duration-300 ease-in-out"
        ></span>
        <span
          id="bar-2"
          class="absolute left-0 top-[6px] block h-0.5 w-5 bg-current transition-all duration-300 ease-in-out"
        ></span>
        <span
          id="bar-3"
          class="absolute left-0 bottom-0 block h-0.5 w-5 bg-current transition-all duration-300 ease-in-out"
        ></span>
      </div>
    </button>
  </nav>

  <!-- Mobile overlay -->
  <div
    id="mobile-menu"
    class="fixed inset-0 z-40 hidden flex-col items-center justify-center bg-white"
  >
    <ul class="flex flex-col items-center gap-6">
      {
        navItems.map((item) => (
          <li>
            <a
              href={item.href}
              class:list={[
                "mobile-nav-link text-lg transition-colors hover:text-gray-900",
                isActive(item.href)
                  ? "font-bold text-gray-900"
                  : "text-gray-600",
              ]}
              {...(isActive(item.href) ? { "aria-current": "page" } : {})}
            >
              {item.label}
            </a>
          </li>
        ))
      }
    </ul>
  </div>
</header>

<script>
  document.addEventListener("astro:page-load", () => {
    const toggle = document.getElementById("menu-toggle")
    const menu = document.getElementById("mobile-menu")
    const bar1 = document.getElementById("bar-1")
    const bar2 = document.getElementById("bar-2")
    const bar3 = document.getElementById("bar-3")
    const mobileLinks = document.querySelectorAll(".mobile-nav-link")

    function openMenu() {
      menu?.classList.remove("hidden")
      menu?.classList.add("flex")
      bar1?.classList.add("top-[6px]", "rotate-45")
      bar1?.classList.remove("top-0")
      bar2?.classList.add("opacity-0")
      bar3?.classList.add("bottom-[6px]", "-rotate-45")
      bar3?.classList.remove("bottom-0")
      toggle?.setAttribute("aria-expanded", "true")
      toggle?.setAttribute("aria-label", "Sulje valikko")
    }

    function closeMenu() {
      menu?.classList.add("hidden")
      menu?.classList.remove("flex")
      bar1?.classList.remove("top-[6px]", "rotate-45")
      bar1?.classList.add("top-0")
      bar2?.classList.remove("opacity-0")
      bar3?.classList.remove("bottom-[6px]", "-rotate-45")
      bar3?.classList.add("bottom-0")
      toggle?.setAttribute("aria-expanded", "false")
      toggle?.setAttribute("aria-label", "Avaa valikko")
    }

    toggle?.addEventListener("click", () => {
      const isOpen = toggle.getAttribute("aria-expanded") === "true"
      if (isOpen) {
        closeMenu()
      } else {
        openMenu()
      }
    })

    mobileLinks.forEach((link) => {
      link.addEventListener("click", () => {
        closeMenu()
      })
    })
  })
</script>
