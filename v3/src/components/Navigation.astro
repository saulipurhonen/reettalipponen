---
import { UI_STRINGS, DEFAULT_LOCALE } from '../lib/i18n';

const navItems = UI_STRINGS[DEFAULT_LOCALE].navigation;
const pathname = Astro.url.pathname;

function isActive(href: string): boolean {
  if (href === '/') {
    return pathname === '/';
  }
  return pathname.startsWith(href);
}
---

<header class="relative z-50">
  <nav class="mx-auto flex max-w-6xl items-center justify-between px-4 py-4">
    <!-- Desktop nav -->
    <ul class="hidden md:flex md:items-center md:gap-6">
      {navItems.map((item) => (
        <li>
          <a
            href={item.href}
            class:list={[
              'text-sm transition-colors hover:text-gray-900',
              isActive(item.href) ? 'font-bold text-gray-900' : 'text-gray-600',
            ]}
            {...(isActive(item.href) ? { 'aria-current': 'page' } : {})}
          >
            {item.label}
          </a>
        </li>
      ))}
    </ul>

    <!-- Mobile hamburger button -->
    <button
      id="menu-toggle"
      class="md:hidden p-2"
      type="button"
      aria-label="Avaa valikko"
      aria-expanded="false"
      aria-controls="mobile-menu"
    >
      <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path id="icon-open" stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
        <path id="icon-close" class="hidden" stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </nav>

  <!-- Mobile overlay -->
  <div
    id="mobile-menu"
    class="fixed inset-0 z-40 hidden flex-col items-center justify-center bg-white"
  >
    <ul class="flex flex-col items-center gap-6">
      {navItems.map((item) => (
        <li>
          <a
            href={item.href}
            class:list={[
              'mobile-nav-link text-lg transition-colors hover:text-gray-900',
              isActive(item.href) ? 'font-bold text-gray-900' : 'text-gray-600',
            ]}
            {...(isActive(item.href) ? { 'aria-current': 'page' } : {})}
          >
            {item.label}
          </a>
        </li>
      ))}
    </ul>
  </div>
</header>

<script>
  const toggle = document.getElementById('menu-toggle');
  const menu = document.getElementById('mobile-menu');
  const iconOpen = document.getElementById('icon-open');
  const iconClose = document.getElementById('icon-close');
  const mobileLinks = document.querySelectorAll('.mobile-nav-link');

  function openMenu() {
    menu?.classList.remove('hidden');
    menu?.classList.add('flex');
    iconOpen?.classList.add('hidden');
    iconClose?.classList.remove('hidden');
    toggle?.setAttribute('aria-expanded', 'true');
    toggle?.setAttribute('aria-label', 'Sulje valikko');
  }

  function closeMenu() {
    menu?.classList.add('hidden');
    menu?.classList.remove('flex');
    iconOpen?.classList.remove('hidden');
    iconClose?.classList.add('hidden');
    toggle?.setAttribute('aria-expanded', 'false');
    toggle?.setAttribute('aria-label', 'Avaa valikko');
  }

  toggle?.addEventListener('click', () => {
    const isOpen = toggle.getAttribute('aria-expanded') === 'true';
    if (isOpen) {
      closeMenu();
    } else {
      openMenu();
    }
  });

  mobileLinks.forEach((link) => {
    link.addEventListener('click', () => {
      closeMenu();
    });
  });
</script>
